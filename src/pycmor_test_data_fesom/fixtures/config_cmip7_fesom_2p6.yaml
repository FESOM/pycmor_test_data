pycmor:
  version: "unreleased"
  use_xarray_backend: True
  warn_on_no_rule: False
  minimum_jobs: 8
  maximum_jobs: 10
general:
  name: "fesom_2p6_pimesh"
  description: "FESOM 2.6 PI mesh configuration for CMIP7"
  maintainer: "pgierz"
  email: "pgierz@awi.de"
  cmor_version: "CMIP7"
  mip: "CMIP"
  frequency: "mon"
  # CV_Dir is optional - uses ResourceLoader fallback chain
  # CMIP_Tables_Dir is not needed for CMIP7 (uses packaged data)
rules:
  - name: "thetao_with_levels"
    experiment_id: "piControl"
    activity_id: "CMIP"
    output_directory: "./output"
    source_id: "FESOM"
    institution_id: "AWI"
    grid_label: gn
    variant_label: "r1i1p1f1"
    model_component: "ocean"
    compound_name: "ocean.thetao.mean.mon.gn"
    inputs:
      - path: "{{ datadir }}/outdata/fesom"
        pattern: "temp.fesom..*\\.nc"
    cmor_variable: "thetao"
    model_variable: "temp"
    mesh_path: "{{ datadir }}/input/fesom/mesh/pi"
    pipelines:
      - level_regridder
pipelines:
  - name: level_regridder
    steps:
      - pycmor.core.gather_inputs.load_mfdataset
      - pycmor.std_lib.generic.get_variable
      - pycmor.fesom_1p4.nodes_to_levels
      - pycmor.core.caching.manual_checkpoint
      - pycmor.std_lib.generic.trigger_compute
      - pycmor.std_lib.generic.show_data
distributed:
  worker:
    memory:
      target: 0.6
      spill: 0.7
      pause: 0.8
      terminate: 0.95
    resources:
      CPU: 4
    death-timeout: 60
jobqueue:
  slurm:
    queue: compute
    project: ab0246
    cores: 4
    memory: 128GB
    walltime: '00:30:00'
    job-extra:
      - '--exclusive'
    worker-template:
      command: |
        srun --ntasks=1 --cpus-per-task=4 --mem=128G dask-worker \
          --nthreads 4 --memory-limit 128GB --death-timeout 60
    scheduler-template:
      command: |
        srun --ntasks=1 --cpus-per-task=1 dask-scheduler
